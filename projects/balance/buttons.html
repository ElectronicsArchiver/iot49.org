
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buttons &#8212; Electronics for IoT</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://iot49.org/projects/balance/buttons.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Precision Scale" href="hx711.html" />
    <link rel="prev" title="Display" href="display.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Electronics for IoT</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  ide49
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/install.html">
   Install
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/configuration.html">
   Configuration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/password.html">
     Change Password
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/backup.html">
     Backup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/dns.html">
     Domain Name
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/https.html">
     Https &amp; Certificates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/samba.html">
     Samba File Server/Client
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/micropython.html">
   MicroPython
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/iot-kernel.html">
     IoT Kernel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/REPL.html">
     REPL prompt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/files.html">
     File Management
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/compile.html">
     Compile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/flash.html">
     Flash
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/reference.html">
   Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services.html">
     Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/nginx.html">
     Nginx
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/jupyter.html">
     Jupyter Lab
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/editor.html">
     Editor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/backup.html">
     Backup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/plotserver.html">
     Plotserver
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/balena-cli.html">
     Balena CLI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/samba.html">
     Samba
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/mosquitto.html">
     MQTT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/arm32.html">
     arm32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/services/esp-idf.html">
     ESP IDF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/reference/customize.html">
     Customize
     <em>
      ide49
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/issues.html">
   Issues
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../balance.html">
   Kitchen Scale with MicroPython
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="parts.html">
     Parts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="circuit.html">
     Circuit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="code.html">
     MicroPython Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="display.html">
     Display
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Buttons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hx711.html">
     Precision Scale
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ble.html">
     Bluetooth
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="app.html">
     Standalone App
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ticks.html">
     “Troubled” Times
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  IoT
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../iot/micropython.html">
   MicroPython
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../iot/gpio.html">
   GPIO
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/projects/balance/buttons.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/iot49/iot49.org"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/iot49/iot49.org/issues/new?title=Issue%20on%20page%20%2Fprojects/balance/buttons.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/iot49/iot49.org/edit/master/docs/projects/balance/buttons.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="buttons">
<h1>Buttons<a class="headerlink" href="#buttons" title="Permalink to this headline">¶</a></h1>
<p>Let’s implement a “tare” function: a button that, when pressed, zeroes the output. Very useful when you bake a cake to “null” the weight of the container you put the contents in.</p>
<p>Reading buttons is quite easy, just connect one terminal of the button to ground and the other to an input of the microcontroller.</p>
<p>Whenever you press the button, the microcontroller input is zero. But what happens when you let the button go? The input is disconnected and it’s value is undefined!</p>
<p>That’s easily fixed by adding a resistor between the microcontroller input and the supply, 3.3V. Now the input is at 3.3V, pulled up by the resistor. Pressing the button will pull it down to 0V. Since the current flowing into the input is very small, you can use a large resistor (e.g. 100kOhm) to minimize power dissipation.</p>
<p>The need for such “pull-up resistors” arises frequently. Because of this, many microcontrollers have resistors built-in that can be enabled with software.</p>
<p>The code below assumes a button connected to <code class="docutils literal notranslate"><span class="pre">IO15</span></code> (button <code class="docutils literal notranslate"><span class="pre">A</span></code> of the OLED wing). The code for configuring the button with the pull-up enabled is below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>%cd $IOT/iot49.org/docs/projects/balance
%connect balance

# reset the microcontroller to start from a &quot;clean&quot; slate
%softreset

from machine import Pin
import time

button = Pin(15, mode=Pin.IN, pull=Pin.PULL_UP)

start = time.ticks_ms()
last_state = button.value()

while True:
    state = button.value()
    if state != last_state:
        if state == 0:
            print(&quot;pressed&quot;)
        else:
            print(&quot;released&quot;)
        last_state = state
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cwd = /home/iot/iot49.org/docs/projects/balance
<span class=" -Color -Color-Black -Color-Black-BGCyan">Connected to balance @ serial:///dev/ttyUSB0</span>

<span class=" -Color -Color-Red -Color-Red-BGCyan">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<span class=" -Color -Color-Red -Color-Red-BGCyan">!!!!!   softreset ...     !!!!!</span>
<span class=" -Color -Color-Red -Color-Red-BGCyan">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

pressed
released
pressed
released

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Interrupted
</pre></div>
</div>
</div>
</div>
<p>Click the little square at the top of the notebook display to stop the program.</p>
<p>The “mechanics” of buttons frequently results in a phenomenon called <em>bouncing</em>: rather than simply making electrical contact when pressed, the button contacts bounce off each other a few times before making solid contact.</p>
<p>This happens within milliseconds, not discernible to humans but well within the speed of microcontrollers. Because of this, tasks such as counting the number of button presses may report incorrect results.</p>
<p>The simplest remedy is to use a timer and ignore button “presses” for, say 100ms, after one has occurred. The button class, below, does just that. It uses <a class="reference internal" href="ticks.html"><span class="doc std std-doc">MicroPython function <code class="docutils literal notranslate"><span class="pre">ticks_diff</span></code></span></a> to calculate time differences. Click on the link for an explanation.</p>
<p>In addition it uses interrupts to detect changes, rather than polling in a loop like the code above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">Pin</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">Button</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">debounce_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debounce_ms</span> <span class="o">=</span> <span class="n">debounce_ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">PULL_UP</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_irq</span><span class="p">,</span> <span class="n">trigger</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IRQ_FALLING</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_irq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_ms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_diff</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debounce_ms</span><span class="p">:</span>
            <span class="c1"># ignore &quot;button presses&quot; within debounce interval</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;debounce&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span> <span class="o">=</span> <span class="n">now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> pressed </span><span class="si">{}</span><span class="s2"> times&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span><span class="p">))</span>
        
<span class="n">button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># report (print) button presses for a few seconds</span>
<span class="c1"># this is just for testing</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pin(15) pressed 1 times
Pin(15) pressed 2 times

</pre></div>
</div>
</div>
</div>
<p>Depending on your switch, you may or may not see “debounce” in action.</p>
<p>Now let’s use this function to implement <em>tare</em>. For that we modify the <code class="docutils literal notranslate"><span class="pre">Button</span></code> class, taking a handler function that is called each time the button is pressed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scale</span> <span class="kn">import</span> <span class="n">Scale</span>
<span class="kn">from</span> <span class="nn">ssd1306</span> <span class="kn">import</span> <span class="n">SSD1306_I2C</span>
<span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">Pin</span><span class="p">,</span> <span class="n">ADC</span><span class="p">,</span> <span class="n">I2C</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">Button</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">debounce_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debounce_ms</span> <span class="o">=</span> <span class="n">debounce_ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">PULL_UP</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_irq</span><span class="p">,</span> <span class="n">trigger</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IRQ_FALLING</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_irq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_ms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_diff</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debounce_ms</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span> <span class="o">=</span> <span class="n">now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
                

<span class="c1"># configure the display</span>
<span class="n">i2c</span> <span class="o">=</span> <span class="n">I2C</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="n">sda</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">23</span><span class="p">))</span>
<span class="n">oled</span> <span class="o">=</span> <span class="n">SSD1306_I2C</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">i2c</span><span class="p">)</span>


<span class="c1"># initialize the scale and button</span>
<span class="c1"># the button, when pressed, calls the tare function of Scale</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">Scale</span><span class="p">()</span>
<span class="n">tare_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale</span><span class="o">.</span><span class="n">tare</span><span class="p">)</span>

<span class="n">last_weight</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
    <span class="c1"># print only significant changes</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">weight</span><span class="o">-</span><span class="n">last_weight</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">oled</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">oled</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:8.0f}</span><span class="s2"> gram&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">oled</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">last_weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tare
tare

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Interrupted
</pre></div>
</div>
</div>
</div>
<p>Play with the “tare” button. Is it working correctly?</p>
<p>Use one of the other buttons to switch between weight in grams and ounces.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">lib</span><span class="o">/</span><span class="n">button</span><span class="o">.</span><span class="n">py</span>

<span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">Pin</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">Button</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">debounce_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debounce_ms</span> <span class="o">=</span> <span class="n">debounce_ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">PULL_UP</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_irq</span><span class="p">,</span> <span class="n">trigger</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IRQ_FALLING</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_irq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_ms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_diff</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debounce_ms</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_press</span> <span class="o">=</span> <span class="n">now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing lib/button.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">rsync</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">ADD     /lib/button.py</span>

</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "iot_kernel"
        },
        kernelOptions: {
            kernelName: "iot_kernel",
            path: "./projects/balance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'iot_kernel'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="display.html" title="previous page">Display</a>
    <a class='right-next' id="next-link" href="hx711.html" title="next page">Precision Scale</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Bernhard Boser<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>
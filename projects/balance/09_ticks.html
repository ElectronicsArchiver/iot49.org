
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Time Intervals &#8212; Electronics for IoT</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://iot49.org/projects/balance/09_ticks.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Internet" href="../internet.html" />
    <link rel="prev" title="“Precision” Scale" href="08_hx711.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Electronics for IoT</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ide49
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/install.html">
   Install
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/configuration.html">
   Configuration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/password.html">
     Change Password
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/backup.html">
     Backup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/timezone.html">
     Timezone
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/dns.html">
     Domain Name
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/https.html">
     Https &amp; Certificates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/samba.html">
     Samba File Server/Client
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/mosquitto.html">
     Mosquitto MQTT Broker
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/micropython.html">
   MicroPython
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/iot-kernel.html">
     IoT Kernel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/magics.html">
     Magics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/REPL.html">
     REPL prompt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/dev_config.html">
     Device Configuration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/flash.html">
     Flashing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/compile.html">
     Compile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/mp_ext_c.html">
     External C modules
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/app.html">
   Docker App
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/app/overview.html">
     Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/app/customize.html">
     Customize
     <em>
      ide49
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/issues.html">
   Issues
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tours &amp; Projects
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../balance.html">
   GPIO
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01_parts.html">
     Parts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_circuit.html">
     Circuit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_code.html">
     MicroPython Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_display.html">
     Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05_buttons.html">
     Buttons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06_ble.html">
     Bluetooth
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07_app.html">
     Standalone App
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08_hx711.html">
     “Precision” Scale
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Time Intervals
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../internet.html">
   Internet
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/wifi.html">
     WiFi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/sockets.html">
     Sockets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/requests.html">
     Requests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/mqtt.html">
     MQTT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/wireshark.html">
     Wireshark
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/ota.html">
     ESP32 OTA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/encryption.html">
     Encryption
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../wifi-cop.html">
   WiFi Coprocessor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/overview.html">
     Approach
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/custom_c.html">
     Custom MicroPython
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/rpc.html">
     RPC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/networking.html">
     Networking
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/projects/balance/09_ticks.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/iot49/iot49.org"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/iot49/iot49.org/issues/new?title=Issue%20on%20page%20%2Fprojects/balance/09_ticks.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/iot49/iot49.org/edit/master/docs/projects/balance/09_ticks.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem">
   Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-monotonic">
   <code class="docutils literal notranslate">
    <span class="pre">
     time.monotonic
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   Solutions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-ticks-xxx">
   <code class="docutils literal notranslate">
    <span class="pre">
     time.ticks_XXX
    </span>
   </code>
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="time-intervals">
<h1>Time Intervals<a class="headerlink" href="#time-intervals" title="Permalink to this headline">¶</a></h1>
<p>The need to measure time intervals occurs frequently in microcontroller programming. Examples include detecting the duration of pulses in a Morse Code like signal as those emitted from infrared controllers, or measuring the frequency of button presses for debouncing.</p>
<p>In principal microcontrollers are very well equipped for the task. Thanks to their high clock speed, they can programmatically resolve microsecond or even nanosecond intervals even without resorting to special hardware features. Conversely, using counters, they can easily track years or even millenia, provided that the power stays on and someone is there to care.</p>
<p>This large dynamic range, nanoseconds to millenia, poses some challenges that, if not properly dealt with, can result in erratic behavior.</p>
<div class="section" id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Permalink to this headline">¶</a></h2>
<p>In principle, representing such intervals is quite easy. A 64-bit integer can represent 584,942 years with microsecond resolution. The problem is that most microcontrollers use 32-bit integers. MicroPython “looses” a bit or two to represent the datatype. An additional bit is used for the sign, hence we are left with 29 bits. That’s sufficient to represent just 9 minutes with microsecond resolution. With millisecond resolution we get a little over 6 days.</p>
<p>Measuring time is typically accomplished with a counter initialized to zero on powerup and then incremented every millisecond or so. MicroPython has a function <code class="docutils literal notranslate"><span class="pre">time.ticks_ms()</span></code> that returns the time in microseconds since the device was turned on.</p>
<p>For example, to measure the duration of button presses (or some sensor input, let’s say the duration of a flash of light), we take the time when the button was pressed and when it was released and compute the difference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">ticks_ms</span>

<span class="c1"># wait for button press</span>
<span class="c1"># ...</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">ticks_ms</span><span class="p">()</span>

<span class="c1"># wait for button released</span>
<span class="c1"># ...</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">ticks_ms</span><span class="p">()</span>

<span class="c1"># calculate the duration of the button press</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span>    <span class="c1"># BUG - see below</span>
</pre></div>
</div>
<p>This <em>mostly</em> works. Except that every six days the measured duration <em>may</em> be incorrect results if the timer “overflows”. Needless to say that such bugs are extremely difficult to diagnose since they occur so infrequently. Because of this they often escape testing, showing up only after the product has been relased to customers with possibly disastrous results.</p>
</div>
<div class="section" id="time-monotonic">
<h2><code class="docutils literal notranslate"><span class="pre">time.monotonic</span></code><a class="headerlink" href="#time-monotonic" title="Permalink to this headline">¶</a></h2>
<p>C-Python has a function <code class="docutils literal notranslate"><span class="pre">time.monotonic()</span></code> that returns time (with arbitrary offset) in seconds as a 64-bit floating point number. With floating point the resolution decreases for long durations to less than microseconds after half a million years, but most of us won’t be around to notice.</p>
<p><a class="reference external" href="https://circuitpython.org/">CircuitPython</a>, a fork of MicroPython, also offers <code class="docutils literal notranslate"><span class="pre">time.monotonic()</span></code> but returns a 32-bit float rather than 64-bits. Now the resolution drops quite quickly, in just days or minutes. Many applications keep microcontrollers busy for much longer than that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">connect</span> <span class="n">huzzah32</span>

<span class="c1"># simulate `time.monotonic()` just after powerup:</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># simulate 1ms interval:</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="o">+</span><span class="mf">0.001</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;duration =&quot;</span><span class="p">,</span> <span class="n">stop</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Black -Color-Black-BGCyan">Connected to huzzah32 @ serial:///dev/ttyUSB0</span>
duration = 0.001

</pre></div>
</div>
</div>
</div>
<p>The measured duration is 1ms, as it should be.</p>
<p>Now let’s repeat the same experiment but after the micrcontroller has been running for a day:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulate `time.monotonic()` just after a day:</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">3600</span><span class="o">*</span><span class="mf">24.0</span>

<span class="c1"># simulate 1ms interval:</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="o">+</span><span class="mf">0.001</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;duration =&quot;</span><span class="p">,</span> <span class="n">stop</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>duration = 0.0

</pre></div>
</div>
</div>
</div>
<p>Zero? That’s clearly wrong and the consequence of the limited resolution of 32-bit floats. If you play around with the above code you find that after one day, the smallest interval that can be resolved is 4ms, albeit the duration is reported as 7ms.</p>
<p>Perhaps you do not need millisecond resolution. But even 10ms cannot be resolved after 4 days.</p>
</div>
<div class="section" id="solutions">
<h2>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline">¶</a></h2>
<p>There are several solutions for this. We could allocate more bits for representing time, for example using Python <em>bigints</em>. In fact, (Circuit)Python’s <code class="docutils literal notranslate"><span class="pre">time.monotonic_ns()</span></code> does just this.</p>
<p>This works correctly and has the great benefit of being standard Python (i.e. code works also in C-Python) but has potential drawbacks. First, <em>bigints</em> are less efficient than (small) ints or floats. Secondly, and more importantly, they are allocated on the heap. Because of this they cannot be used in <a class="reference external" href="https://docs.micropython.org/en/latest/reference/isr_rules.html#isr-rules">interrupt service routines</a>. Since interrupts are precisely a situation where measuring time is often needed, that’s a quite significant gotcha.</p>
<p>Note that CircuitPython does not implement interrupts in user code. That’s also a solution, if you don’t need them.</p>
</div>
<div class="section" id="time-ticks-xxx">
<h2><code class="docutils literal notranslate"><span class="pre">time.ticks_XXX</span></code><a class="headerlink" href="#time-ticks-xxx" title="Permalink to this headline">¶</a></h2>
<p>MicroPython chooses a different route. <code class="docutils literal notranslate"><span class="pre">time.ticks_ms()</span></code> and <code class="docutils literal notranslate"><span class="pre">time.ticks_us()</span></code> both return time as small ints. Because of this they “roll-over” after a few minutes or days. The special function <code class="docutils literal notranslate"><span class="pre">time.ticks_diff()</span></code> takes into account the roll over.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_us</span><span class="p">()</span>  <span class="c1"># or ticks_ms</span>

<span class="c1"># do whatever you want to measure the duration of</span>
<span class="c1"># ...</span>

<span class="n">stop</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_us</span><span class="p">()</span>
</pre></div>
</div>
<p>To get the duration</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ticks_diff</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>  <span class="c1"># CORRECT</span>
</pre></div>
</div>
<p>Rather than the (incorrect)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span>  <span class="c1"># WRONG in case of roll-over</span>
</pre></div>
</div>
<p>The “correct” option works properly as long as no more than one roll-over occurs during the measurement interval. This limits the maximum duriation that can be measured with <code class="docutils literal notranslate"><span class="pre">time.ticks_ms()</span></code> to about six days. With <code class="docutils literal notranslate"><span class="pre">time.ticks_us()</span></code> the maximum is about nine minutes.</p>
<p>Admittedly using <code class="docutils literal notranslate"><span class="pre">time.ticks_diff()</span></code> to compute time differences is a bit clumsy. But it works correctly, is efficient, and can be used even in interrupt service routines. After pondering the alternatives (and even implementing custom helpers in C), I always come back to using <code class="docutils literal notranslate"><span class="pre">ticks_XXX</span></code>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "iot_kernel"
        },
        kernelOptions: {
            kernelName: "iot_kernel",
            path: "./projects/balance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'iot_kernel'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="08_hx711.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">“Precision” Scale</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../internet.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Internet</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Bernhard Boser<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>